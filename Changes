Sun Mar  1 00:10:21 2009  fox

     175* Archive: 1.0067

     174* toxic.c: Added to allow filtering of bad probe funcs in the
          kernel. Not finished yet (for my kernel).

     173* dtrace.c, fbt_linux.c: Add support for fbt:kernel:... so
          we can start tracing real kernel functions. This is dangerous
	  at this time (wait for next update?) since you can trace
	  anything - including the bits of the kernel dtrace depends on.
	  Next step is to hide those symbols we depend on so you can
	  do:

	  dtrace -n fbt:kernel::

     172* cpu_32bit.c: Add support for 89 c0..c7 (mov %eax,reg)

     171* Archive: 1.0066

     170* dtrace_asm.c: Fix dtrace_interrupt_disable - we broke
          the C/asm interface semantics - would crash a real cpu, but
	  not vmware for some reason.

Sat Feb 28 22:45:59 2009  fox

     169* makefile: recreate build symlink each time in case of kernel
          upgrade.

Fri Feb 27 20:16:31 2009  fox

     168* makefile: Add a 'build' number when we create a release in case
          we release multiple times per day.

     167* fbt_linux.c, cpu_32bit.c: Add support for 

     	XOR reg,reg
	JMP nnnn

	instructions

     166* driver/cpu_emulate.c: Split into cpu_32bit.c and cpu_64bit.c

     165* Archive: 1.0065

     164* dtrace_asm.c: Fix nesting of interrupt disable for i386.

Wed Feb 25 19:11:10 2009  fox

     163* load.pl: If we have an error, tell them a little more about
          why the driver load failed.

     162* makefile: Add a dependency checker before people build.

Mon Feb 23 21:45:13 2009  fox

     161* cpu_emulate.c: Emulate SUB $4,ESP

     160* cpu_emulate.c: Emulate TEST EAX,EAX

     159* cpu_emulate.c: Fix SUB $nn,ESP where nn == 0x18

Sun Feb 22 11:31:20 2009  fox

     158* cpu_emulate.c: Add support for SUB $8,ESP

     157* cpu_emulate.c: Fix problem with SUB $12,ESP instruction

     156* Archive: 1.0064

     155* systrace.c: Fix for sys_clone - now we dont get the core dumps.

     154* systrace.c: Fix for sigreturn needing a proper call frame so
          it can patch the registers. [i386 only]

	  This appears to work

	  dtrace -n syscall:::

Sat Feb 21 10:25:07 2009  fox

     153* cpu_emulate.c: Emulate PUSH ESI.
          We need to avoid having a zillion case/defines where we
	  can use the CPU opcode decoding to get big-bang-for-buck.
	  We need to pass in the missing opcode so we can decide
	  which is better to do.

     152* dtrace_linux.c: Use vmalloc for large buffer allocations to avoid
          smacking the kernel badly with our large probe buffer.

     151* cpu_emulate.c: Emulate PUSH EDI

Fri Feb 20 20:12:05 2009  fox

     150* cpu_emulate.c: Emulate PUSH EBX

     149* makefile+tools/bug.sh: Add a .release file, so we know
          what people are building on when reporting a bug.

     148* drivers/missing.c: Fix for 2.6.23.1-42.fc8 missing
          find_task_by_vpid.

Thu Feb 19 21:55:51 2009  fox

     147* cpu_emulate.c: Add support for "SUB $12,ESP" - where the
          reti stack frame overlapped our saved regs. Special case.
	  We can merge this with the generic (>12) case later.
	  Still need to handle "SUB $8,ESP" and "SUB $4,ESP"...which
	  should be easier for we have the $12 code.

     146* Few cleanups and fixes for AS4 release.

Wed Feb 18 21:58:50 2009  fox

     145* dt_link.c: Fix properly for 32 + 64 bit architectures.
          Same reason as below. Also create a temp file to contain
	  the intermediate linker object rather than rely on /dev/fd/NNN.

Tue Feb 17 22:07:40 2009  fox

     144* dt_link.c: When writing the USDT output object file, use
          a section type of SHT_PROGBITS and not SHT_SUNW_dof, since
	  some older binutils/ld will not like what we did (too
	  over zealous validation).

Mon Feb 16 22:59:10 2009  fox

     143* Archive: 1.0061

     142* cpu_emulate.c: Add support for "SUB $nnn,%ESP"

Sun Feb 15 10:47:15 2009  fox

     141* fbt_linux.c, dtrace_linux.c: Use INT3 traps for entry/return
          Need to handle more than just LEAVE/RET for FBT on i386.
	  Fix INT3 handler to emulate the blotted-out instruction.

     140* Archive: 1.0060

Sun Feb  8 10:02:02 2009  fox

     139* Archive: v1.0059

     138* cpu_emulate.c: The fbt for i386 wont work on Linux since gcc
          generates lots of differing instructions for a function
	  (also, potentially inline assembler). We need to do more
	  of a job for i386. So start to handle the new instructions
	  we are seeing in the various kernel functions.

Sat Feb  7 22:08:31 2009  fox

     137* dtrace_linux.c: Fix FBT so it works for x86-64
          Not working properly for 32bit kernel yet.

Fri Feb  6 11:09:54 2009  fox

     136* Archive: 1.0057

     135* drivers/include -> ./include due to new build structure.
          build/ is a symlink to build-`uname -r`. 
	  drivers/dtrace/* -> driver

     134* makefiles: Allow us to label the build dir with the appropriate
          kernel version, so we can do multiple kernel builds.

Thu Feb  5 10:35:22 2009  fox

     133* Archive: 1.055

     132* fasttrap.c: Werent initting the fasttrap_proc_t mutex, so
          we died if a USDT process exited.

     131* Fix dtrace_casptr for i386 which would cause copyinstr
          to fail.

Wed Feb  4 21:17:32 2009  fox

     130* Various: changes to better manage multikernels. Compiled
          against 2.6.9, 2.6.24, 2.6.26, 2.6.28

Tue Feb  3 13:03:37 2009  fox

     129* Archive: 1.0054

     128* systrace.c: Re-engineered to the syscall table patcher --
          now works inside vmware and a real 32bit cpu.

	  Kernel can still panic if you do some syscall tracing
	  and try and do copyinstr(arg0) - need to find out why.

Mon Feb  2 17:27:39 2009  fox

     127* ctl.c: Disable the hunt_init/hunt_cleanup code for the moment
          as its crashing the x86 cpu (32b).

     126* dtrace_asm.c: Found an issue with the membar functions which
          dont work on a real x86(32b) cpu, but do on a VMware
	  session on a 64b processor, and in 64bit mode. Use SFENCE
	  instruction.

     125* Archive: 1.0053

     124* Now works on Ubuntu 2.6.24-16 (32bit) kernel

     123* sys/privregs.h: Move the horrors of register and regs/pt_regs
          into here. Need to cater for older kernels and i386/x86-64 too.

Sun Feb  1 15:28:56 2009  fox

     122* Various: tidy up some kernel compile warnings; remove some
          unneeded zero length headers. 

	  Arrange for proc_exit notification to wipe out fasttrap
	  probes.

     121* Various: refactor datamodel computation because we may treat
          a 64b proc as a 32b one and access the wrong values for 
	  copyinstr().

	  We still have some USDT issues: dtrace doesnt know the target
	  proc exited, so leaves the probes behind.

     120* Archive: 1/0052

Sat Jan 31 10:42:32 2009  fox

     119* fasttrap_isa.c: Changes to compile on 32bit kernel (tested on
          2.6.28 kernel).

Fri Jan 30 22:48:51 2009  fox

     118* dt_lex.l: Compat support for AS4 version of flex.

Tue Jan 27 23:22:35 2009  fox

     117* Archive: 1.0051

Mon Jan 26 22:42:20 2009  fox

     116* dtrace_linux.c: Fix uwrite() interface.

Sun Jan 18 18:51:13 2009  fox

     115* dtrace_linux.c: Put in a trap handler for INT3 and pass onto
          to dtrace. Not there yet....

Thu Jan 15 20:56:19 2009  fox

     114* Archive: 1.0050

     113* tests/dt019: Simple usdt example we are trying to make work.

     112* fasttrap.c: Avoid kernel panic when we find the target to intercept.
          Still not write because we commented out uread/uwrite.

Tue Jan 13 23:52:50 2009  fox

     111* Archive: 1.0049

     110* fasttrap.c: Define fasttrap_max so that USDT starts to work.
          libdtrace/: Lots of hackery to allow us to launch a process.
	  (Not yet working to completion yet)

Sun Dec 28 00:02:27 2008  fox

     109* dtrace_linux.c: Remove old no-longer needed kernel dependencies
          so we can compile on 2.6.28

     108* drivers/dtrace/systrace.c: Fixes to build on 2.6.27.10 kernel
          for 32-bit.

     107* dt_link.c: Generate correct ELF patchups for 32-bit libc6 code.
          (usdt now builds the user space simple executable)

Sat Dec 27 04:35:47 2008  fox

     106* liblinux/getopt.c: Add this because some getopt()s are doing
          weird stuff compared to GNU getopt.

Sat Dec 20 22:34:13 2008  fox

     105* makefile, tools/build.pl: Handle i686 (32-bit) platform.

Sat Dec 13 08:45:52 2008  fox

     104* systrace.c: Avoid panicing 2.6.27.8 kernel due to bad
          syscall name.

     103* ctl.c: Fix crash on unloading driver.
          <ppluzhnikov@google.com>

Fri Dec 12 21:03:00 2008  fox

     102* ctl.c: Fix find_task_by_pid, and improve make-me script.

     101* Archive: 1.0048

     100* dtrace_linux.c: Suggestion to use find_task_by_vpid vs
          find_task_by_pid to avoid kernel-ifdefs.
          <ppluzhnikov@google.com>

      99* drivers/dtrace/dtrace_asm.c, sdt_linux.c, dtrace_isa.c
          Some more OpenSolaris 20081211 alignment changes. Nothing
	  functional fixed, since many of the ON source changes are
	  more in the Sun kernel code than the common stuff here.

      98* drivers/dtrace/dtrace.c: Merge in changes from OpenSolaris 20081211.

Wed Dec 10 10:46:25 2008  fox

      97* tools/mksyscalls.pl: [PATCH] Add verbosity flag; print KGDB module load address.
          <ppluzhnikov@google.com>

      96* tools/mksyscalls.pl: Change to find unistd.h which keeps moving.
          <ppluzhnikov@google.com>

Mon Dec  8 22:07:48 2008  fox

      95* dtrace_linux.c: Patch for on_each_cpu, smp_call_function, and
          asm/stacktrace.h
          <ppluzhnikov@google.com>

Thu Dec  4 20:53:33 2008  fox

      94* drivers/dtrace/dtrace_isa.c: Fix to handle kernel 2.6.26 and
          above.
          (ppluzhnikov@google.com).

      93* drivers/dtrace/dtrace.c: Fix dtrace_errlock bad mutex defn.
          (ppluzhnikov@google.com).

Wed Dec  3 23:16:40 2008  fox

      92* Archive: 1.0046

      91* drivers/dtrace/ctl.c: We now have a /proc/$$/ctl driver visible.
          It doesnt do anything yet, but we have now patched a running
	  kernel.

Wed Nov 12 22:10:51 2008  fox

      90* usdt/*/makefile: Use our compiled dtrace, rather than anything in
          the environment.

Sun Oct 26 16:54:54 2008  fox

      89* dtrace_linux.c: Enable /dev/sdt

Sat Oct 25 10:18:22 2008  fox

      88* fasttrap.c: Can now run a USDT enabled app, but not showing up
          on 'dtrace -l'. No longer hangs/crashes the kernel.

Sun Oct 19 09:58:28 2008  fox

      87* dt_link.c: Now generates correct binary, but drti.o isnt
          correct yet.

      86* Archive: 1.0045

Sun Oct 12 09:47:14 2008  fox

      85* drti.c: Allow us to specify $DTRACE_DRTI_O so we can find
          the drti.o object file;

	  linux_types.h: Fix include issues for dlfcn.h.

	  dtrace_linux.c: Now invoke the dtrace_ioctl_helper function.

Sat Oct 11 10:00:48 2008  fox

      84* drivers/dtrace.c, dtrace_linux.c: Start to enable the 
          /dev/dtrace_helper driver, needed for USDT.

Thu Oct  9 22:36:16 2008  fox

      83* linux_types.h: Add _LITTLE_ENDIAN definition, else dt_link.c
          generates bad ELF .o files.

Wed Oct  8 22:38:54 2008  fox

      82* libdtrace/dt_link.c: Some changes to allow dtrace -G to work.
          Not there yet.

      81* usdt/ New directory to create a simple USDT so we can
          get things sorted.

Sat Aug  2 11:58:07 2008  fox

      80* Archive: 1.0042

      79* dt_module.c: Fixes for 64b kernels - we can now see kernel stack
          traces.

Tue Jul 29 21:27:11 2008  fox

      78* makefile: Build libelf/Gelf structures properly for 32b machines.

Sun Jul 27 08:56:23 2008  fox

      77* dtrace_isa.c: Add in support for getstack to handle stack()
          calls. Not brilliant with -fomit-frame-pointer in the kernel,
	  but that will teach people to use this option :-(

      76* dt_module.c: Add support for reading /proc/kallsyms so we
          can get kernel level stack traces.

Thu Jul 24 08:54:01 2008  fox

      75* dtrace.c: dtrace_probe: Fix issue with 32-bit arguments
          not being sign extended when stored in return struct. Without
	  this, arg0 is never < 0 for failed syscalls.

      74* load.pl: rewrite load shell script as perl as we want to do some
          extra things for some kernels.

      73* fbt_linux.c: Add support for i386/modules[] on 2.6.23.1

Wed Jul 23 07:32:30 2008  fox

      72* fbt_linux.c: Implement work around for 2.6.23.1 kernel
          without public sys_call_table.

      71* dtrace_linux.c: par_alloc should memset the memory
          to zero to avoid firing a signal when it wasnt asked for.

      70* systrace.c, dtrace.c: Implement support for raise/stop actions
          which can send a signal to a process.

      69* load: Detect missing symbols and try to warn user something
          may fail.

Wed Jul 16 22:55:01 2008  fox

      68* systrace.c: Avoid bogus syscalls which can index
          off the end of the array. Likely due to bad stack reference.
	  Avoids SIGKILL near kernel panic when it happens.
	  Trying to bootstrap ustack() call which involves 
	  examining to the proc in user space to grab the symbol
	  table. Race condition (which is catered for) -- the proc
	  may no longer exist by the time dtrace is running.

Sun Jul 13 10:53:44 2008  fox

      67* Archive: 1.0037

      66* Pisadep.c: Got rid of most of our stubs and use proper libproc
          code. This code wont work since its depending on Solaris /procfs
	  but we can start to work our way through this.

Sat Jul 12 10:59:36 2008  fox

      65* Archive: 1.0039

      64* libproc: Upgrade complete.

      63* libproc: Start upgrade to Solaris 20080623, since we cannot
          call ustack() without starting to emulate /procfs on Solaris.

      62* dtrace_isa.c: Fix issue with coying to/from user space.
          arg0/arg1/... now works.

Sun Jul  6 10:29:42 2008  fox

      61* Archive: 1.0035

      60* fasttrap_isa.c: Merged/compiled in - we have some TODOxxx items
          to fix before we can use this.

      59* fasttrap.c: Now compiles, but need to implement timeout()
          function. Next, get fasttrap_isa.c to compile.

Sat Jul  5 14:53:52 2008  fox

      58* dtrace.c, dtrace_linux.c: Implement a parallel shadow to curthread
          so we dont die when doing thread local variables (dt9 test).
	  We now need a garbage collector - otherwise we may leak memory,
	  or have an issue when a new thread comes along on the same address.

	  dt9: demo/vars/rtime.d no longer panics the kernel.

Fri Jul  4 20:35:34 2008  fox

      57* dt_lex.l: Another attempt at fixing the lexing issues with
          flex.

      56* dtrace.c, fasttrap.c: Upgrade to latest ON Solaris release
          20080623.

Thu Jul  3 23:16:19 2008  fox

      55* Move cmd/dtrace/demo to toplevel dir so its more accessible.
          Create tools/runtests.sh so we can start proving the quality
	  of the yacc/lex port.

      54* Archive: 1.0032

      53* profile.c: Now shows up in dtrace -l; allow us to talk to
          /dev/dtrace_profile driver to change max profile probes.

Wed Jul  2 20:46:02 2008  fox

      52* profile.c: Add missing profile driver. Not yet proven and the
          omni support is missing...

      51* utils/libgcc.pl: Script to locate your libgcc.a file rather than
          me supply one.

      50* Mojmir Svoboda: Fix for raw_local_irq_disable() /
          raw_local_irq_enable() to be more backward kernel compliant.
	  Mojmir suggests issues with kmem_cache_create - I think kernel
	  code changed function calling so need to incorporate a kernel
	  specific fix.

Tue Jul  1 21:53:15 2008  fox

      49* dt_lex.l: Lets hope this works because I am mightily sick
         of flex - getting it to work on all platforms. Its an
	 embarrassment.

      48* Archive: 1.0031

      47* put dtrace binary in build/ directory.

      46* dt_lex.l, makefile, dt_impl.h: Get lex to build us properly so
          we can parse the scripts.

Mon Jun 30 20:50:07 2008  fox

      45* cyclic_linux.c: Enable linux cyclic timer code.

Sun Jun 29 11:50:58 2008  fox

      44* Archive: 1.0030

      43* dtrace_linux.c: syscall tracing finally working on 32-bit kernel.

      42* Archive: 1.0029

      41* liblinux/proc2.c: Fix gethrtime and pthread_cond_reltimedwait_np()
          to avoid dtrace eating lots of cpu and filling /var/log/messages.

Thu Jun 26 22:51:51 2008  fox

      40* i386 kernel sys_call_table patching now works, just need to get the
          syscall collector to work.

Mon Jun 23 23:13:08 2008  fox

      39* divmod64.c: Fix the 64-bit divide issue.

Wed Jun 18 23:19:11 2008  fox

      38* Archive: 1.0027

      37* More 32-bit portability changes.

Tue Jun 17 23:02:33 2008  fox

      36* Various: changes to build 32-bit dtrace + driver

Mon Jun 16 22:57:02 2008  fox

      35* cyclic.c: Need the full whack from Solaris. Without this, the
          D Engine will kill us after a while because it thinks we are hanging
	  and may endanger the system stability.

	  We could just write our own, but its doing a lot of complex
	  and well thought out issues to do with accuracy and 
	  cpu alignment, and its not worth hacking this. FreeBSD has
	  its own (slightly simplified) version of the Solaris code.

Sun Jun 15 09:39:19 2008  fox

      34* dtrace_linux.c, fbt_linux.c: Add a (slow/horrid) parallel 
          allocator. Avoids reprobing modules.

      33* Archive: 1.0026

      32* syscall tracing now working !

Sat Jun 14 00:20:36 2008  fox

      31* Archive: 1.0025

      30* dtrace.c: Fix kernel panic when creating an ecb event.
          dt4 now works for BEGIN/END functionality but syscalls not
	  being triggered.

Mon Jun  9 22:05:12 2008  fox

      29* Archive: 1.0024

      28* fbt_linux.c, dtrace_linux.c: Implement a validate_ptr() function
          since we were dying due to bad VM inside the kernel.

Mon Jun  2 21:42:23 2008  fox

      27* fbt_linux.c: Avoid issue with call to __symbol_get() cause
          incremented mod ref count, which stops us unloading.

Sun Jun  1 00:17:23 2008  fox

      26* Archive: 1.0021

Thu May 29 23:07:39 2008  fox

      25* dtrace_linux.c: Create the cpu_list[] structure which dtrace wants.
          Avoids kernel panic when we hit DTRACEIOC_GO.

      24* drivers/dtrace/dtrace.c: More merge-in from ON solaris.

      23* Archive: 1.0020

Wed May 28 22:31:37 2008  fox

      22* drivers/dtrace/dtrace_ioctl.c: Remove this - integrate back in
          with dtrace.c since we are now more aligned and nearly working.

Mon May 26 14:31:54 2008  fox

      21* drivers/dtrace/*: Fix issue where 'dtrace -l' would keep
          adding the same probes. Needed to mimic the init/attach/open
	  cycle of a proper solaris driver. Fixed various crashes due
	  to this, and allows driver to unload properly - no issues in simple
	  testing, but basic probe placement is not working yet - cannot 
	  plant the probes. Not sure why..yet.

Sun May 25 00:35:12 2008  fox

      20* drivers/dtrace.c: Update to latest opensolaris code to help
          find bugs in driver.

      19* Archive: 1.0018

Tue May 20 23:50:24 2008  fox

      18* cmd/dtrace/dtrace.c: Incorporate getopt() fixes from Apple/Darwin.
          Fixes 'dtrace -n BEGIN', but note this will presently crash your
	  kernel if you run it !

Tue May 13 21:56:09 2008  fox

      17* cmd/dtrace/dtrace.c: Fix issue with getopt() not working when
          presented with this command line:

	  cmd/dtrace/dtrace cmd/dtrace/demo/agg/denorm.d /bin/ls

      16* Update the cmd/dtrace demo to the latest version. They broke
          backwards compatibility ! Why ?! The #pragma changed syntax.
	  Thats very very naughty of them. I do hate lex+flex.

Sun May 11 20:54:47 2008  fox

      15* Update libdtrace to latest opensolaris version.
          Update cmd/dtrace/dtrace.c to latest verison.

Mon May  5 09:48:18 2008  fox

      14* /dev/ctf driver now loads but theres lots of inter-driver
          dependencies which are a pain to manage, so may try
	  and create a consolidated driver.

      13* Archive: 1.0010

Mon Apr 28 20:36:54 2008  fox

      12* Archive: 1.0008

      11* Fix dt_lex.l and dt_grammar.y compile fixed so we dont copy
          files from my install tree to the remote install tree.
	  Fixes problem with dtrace plainly not working at all.

      10* dt_grammar.y: Some minor tweaks to handle compiling with
          bison. Sun have an error in their file (missing ';').

Sun Apr 27 00:03:52 2008  fox

       9* Archive: 1.0007

       8* Archive: 1.0006

       7* Put all binaries into the build/ dir rather than littering the
          source. Not done for drivers yet, since Linux kernel build
	  pollutes us. Also made code do a clean build from start to finish.
	  Ignore warnings - will address these over the course of time.

       6* Archive: 1.0005

       5* Various changes for clean build on FC8/2.6.24.4 kernel. Slightly
          broken Ubuntu...to fix next. First part of the driver works, and
	  making some changes to allow cmd/dtrace to talk to the driver.

Mon Apr 21 22:10:40 2008  fox

       4* Surprise: my first kernel panic. /dev/dtrace is the interface
          and if you cat it ... surprise !

Sun Apr 20 20:51:52 2008  fox

       3* Now builds under ubuntu 2.6.22-14-generic kernel and
          RedHat FC* 2.6.24.4-64.fc8. More portability.

	  If you load the driver, you will have 

	  /proc/dtrace/helper
	  /proc/dtrace/dtrace

	  entries. (Non functional since no plumbing at present).

Sat Apr 19 23:08:09 2008  fox

       2* drivers/dtracedrv.ko finally links correctly. However theres still
          quite a few stubs and broken definitions, so be careful - will
	  likely crash your kernel.

Wed Apr  9 21:56:09 2008  fox

       1* dt_lex.l: Fix flex/lex issues - now parses strings properly and
           dtrace -x nolibs -n BEGIN -e -S
	   seems to work - or at least it doesnt core dump or generate
	   a diagnostic.

